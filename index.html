<!doctype html>
<html lang="ru">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript" src="js/jquery-3.5.1.min.js"></script>
    <script src="/js/bootstrap-input-spinner.js"></script>


    <title>phys_prog</title>

</head>
<body>
<script>
    var last_num_numbers = 3;

    function lines_(num){
        console.log(num)
        num = parseInt(num)
        document.getElementById("accordionExample").remove()
        document.getElementById("footer").remove()
        if (num >= 2) {
            last_num_numbers += 1
            for (let f = 1; f <= last_num_numbers; f++) {
                console.log(f)
                document.getElementById(f.toString()).remove()
            }
            num += 1
            for (let g = 1; g < num; g++) {
                console.log(g, num)
                document.body.insertAdjacentHTML("beforeend", '<div class="input-group pb-1 px-3" id="' + g.toString() + '"> <input type="number" class="form-control" aria-label="Text input with dropdown button" placeholder="Сопротивление"> <select class="form-select" aria-label="Default select example"> <option selected>Направление</option> <option value="L">L</option> <option value="R">R</option> </select> <input type="number" class="form-control" aria-label="Text input with dropdown button" placeholder="Вольтаж"> </div>');
            }

            document.body.insertAdjacentHTML("beforeend", '<div class="d-flex flex-row-reverse px-3 pb-2" id="' + num.toString() + '">\n' +
                '    <button class="btn btn-outline-primary" type="button" onclick="decide()">Решить</button>\n' +
                '</div>');
            document.body.insertAdjacentHTML("beforeend", '<div class="accordion px-3" id="accordionExample">\n' +
                '    <div class="accordion-item">\n' +
                '        <h2 class="accordion-header" id="headingOne">\n' +
                '            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">\n' +
                '                MУH\n' +
                '            </button>\n' +
                '        </h2>\n' +
                '        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">\n' +
                '            <div class="accordion-body">\n' +
                '                Нажми на \'решить\', чтобы тут появился ответ.\n' +
                '            </div>\n' +
                '        </div>\n' +
                '    </div>\n' +
                '    <div class="accordion-item">\n' +
                '        <h2 class="accordion-header" id="headingTwo">\n' +
                '            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">\n' +
                '                MH\n' +
                '            </button>\n' +
                '        </h2>\n' +
                '        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">\n' +
                '            <div class="accordion-body">\n' +
                '                Нажми на \'решить\', чтобы тут появился ответ.\n' +
                '            </div>\n' +
                '        </div>\n' +
                '    </div>\n' +
                '    <div class="accordion-item">\n' +
                '        <h2 class="accordion-header" id="headingThree">\n' +
                '            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">\n' +
                '                MКУ(МУКУ)\n' +
                '            </button>\n' +
                '        </h2>\n' +
                '        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">\n' +
                '            <div class="accordion-body">\n' +
                '                Нажми на \'решить\', чтобы тут появился ответ.\n' +
                '            </div>\n' +
                '        </div>\n' +
                '    </div>\n' +
                '</div>')
            document.body.insertAdjacentHTML("beforeend", '<footer class="bg-white col-sm-1 mx-auto py-2" id = "footer">\n' +
                '    <a href="https://github.com/Cynep-SU">\n' +
                '        <img src="github.png" alt="HTML tutorial" style="width:42px;height:42px;">\n' +
                '    </a>\n' +
                '</footer>')

        }
        last_num_numbers = num - 1

    }
</script>
<div class="w-25 p-3" id="0">
    <form>
        <input data-prefix="Колличество ветвей" name="lines" type="number" min=2 class="form-control" aria-label="" value=3 onchange="lines_(this.value)">
    </form>
</div>
<div class="input-group pb-1 px-3" id="1">
    <input type="number" class="form-control" aria-label="Text input with dropdown button" placeholder="Сопротивление">
    <select class="form-select" aria-label="Default select example">
        <option selected>Направление</option>
        <option value="L">L</option>
        <option value="R">R</option>
    </select>
    <input type="number" class="form-control" aria-label="Text input with dropdown button" placeholder="Вольтаж">
</div>
<div class="input-group pb-1 px-3" id="2">
    <input type="number" class="form-control" aria-label="Text input with dropdown button" placeholder="Сопротивление">
    <select class="form-select" aria-label="Default select example">
        <option selected>Направление</option>
        <option value="L">L</option>
        <option value="R">R</option>
    </select>
    <input type="number" class="form-control" aria-label="Text input with dropdown button" placeholder="Вольтаж">
</div>
<div class="input-group pb-1 px-3" id="3">
    <input type="number" class="form-control" aria-label="Text input with dropdown button" placeholder="Сопротивление">
    <select class="form-select" aria-label="Default select example">
        <option selected>Направление</option>
        <option value="L">L</option>
        <option value="R">R</option>
    </select>
    <input type="number" class="form-control" aria-label="Text input with dropdown button" placeholder="Вольтаж">
</div>
<div class="d-flex flex-row-reverse px-3 pb-2" id="4">
    <button class="btn btn-outline-primary" type="button" onclick="decide()">Решить</button>
</div>
<div class="accordion px-3" id="accordionExample">
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                MУH
            </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
            <div class="accordion-body">
                Нажми на 'решить', чтобы тут появился ответ.
            </div>
        </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                MH
            </button>
        </h2>
        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
            <div class="accordion-body">
                Нажми на 'решить', чтобы тут появился ответ.
            </div>
        </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingThree">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                MКУ(МУКУ)
            </button>
        </h2>
        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
            <div class="accordion-body">
                Нажми на 'решить', чтобы тут появился ответ.
            </div>
        </div>
    </div>
</div>
<footer class="bg-white col-sm-1 mx-auto py-2" id = 'footer'>
    <a href="https://github.com/Cynep-SU">
        <img src="github.png" alt="HTML tutorial" style="width:42px;height:42px;">
    </a>
</footer>
<!-- Optional JavaScript; choose one of the two! -->

<!-- Option 1: Bootstrap Bundle with Popper -->
<script src="js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>

<!-- Option 2: Separate Popper and Bootstrap JS -->
<!--
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
-->
</body>
<script>
    $("input[name='lines']").inputSpinner({template: '<div class="input-group ${groupClass}">\n' +
            '<div class="input-group-prepend"></div>\n' +
            '<input type="text" inputmode="decimal" style="text-align: ${textAlign}" class="form-control"/>\n' +
            '<div class="input-group-append">\n' +
            '<button style="min-width: ${buttonsWidth}" class="btn btn-decrement ${buttonsClass}" type="button">${decrementButton}</button>\n' +
            '<button style="min-width: ${buttonsWidth}" class="btn btn-increment ${buttonsClass}" type="button">${incrementButton}</button>\n' +
            '</div></div>'})
    function getXmlHttp() {
        var xmlhttp;
        try {
            xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
        } catch (e) {
            try {
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (E) {
                xmlhttp = false;
            }
        }
        if (!xmlhttp && typeof XMLHttpRequest != 'undefined') {
            xmlhttp = new XMLHttpRequest();
        }
        return xmlhttp;
    }
    var xhr = new XMLHttpRequest();

    // 2. Конфигурируем его: GET-запрос на URL 'phones.json'


    // 3. Отсылаем запрос
    // xhr.send([1, 2, 3]);

    // 4. Если код ответа сервера не 200, то это ошибка

    function decide() {
        let array = []
        let lines_num = document.forms[0].elements.lines.value
        for (let i = 0; i < lines_num + 1; i++) {

            el = document.getElementById(i.toString())
            try{
                let elementChildrens = el.children
                if (elementChildrens.length === 3){
                    for (let i = 0; i < elementChildrens.length; i++) {
                        array.push(elementChildrens[i].value)
                    }
                }
            }catch (e){
                console.log(e)
            }

        }

        xhr.open('POST', 'https://b2a076121e8e.ngrok.io/phys_program', false);
        xhr.send(array);
        if (xhr.status != 200) {
            // обработать ошибку
            alert(xhr.status + ': ' + xhr.statusText); // пример вывода: 404: Not Found
        } else {
            // вывести результат
            document.getElementById('collapseOne').innerText = JSON.parse(xhr.responseText).MYH
            document.getElementById('collapseTwo').innerText = JSON.parse(xhr.responseText).MH
            document.getElementById('collapseThree').innerText = JSON.parse(xhr.responseText).MYKY;
        }
    }
</script>
</html>
